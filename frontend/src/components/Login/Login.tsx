import {
    TextInput,
    PasswordInput,
    Paper,
    Title,
    Container,
    Button,
  } from '@mantine/core';
    import { useState } from 'react';
  import './Login.scss';



  function Login() {

    const [username, setUsername] = useState('');
    const [password, setPassword] = useState('');

    const handleUsernameChange = (event: React.ChangeEvent<HTMLInputElement>) => {
      setUsername(event.target.value);
    };

    const handlePasswordChange = (event: React.ChangeEvent<HTMLInputElement>) => {
      setPassword(event.target.value);
    };

    const handleLogin = () => {
      // Send email and password to server for authentication
      fetch('http://10.0.22.24:8080/api/login', {
        method: 'POST',
        body: JSON.stringify({ username, password }),
        headers: {
          'Content-Type': 'application/json'
        }
      })
        .then(response => {
            if (response.ok) {
                response.json().then(data => {
                  // Store the user in the session variable
                  sessionStorage.setItem('user', JSON.stringify(data.token));
                  // Set the cookie, using token value generated by backend
                  document.cookie = `CookieLogged=${data.token}; expires=${new Date(Date.now() + 60 * 24 * 60 * 60 * 1000).toUTCString()}; path=/`;
                  //debugging
                  alert(`Login successful. Response: ${JSON.stringify(data)}`);
                  console.log('Login successful');
                    // Redirect to the home page
                    window.location.href = '/';

                });
          } else {
            // Display error message if login is unsuccessful
            alert(`Error: ${response.statusText}`);
          }
        })
        .catch(error => {
          console.error('Error:', error);
        });
    };

    const bypass = () => {
      document.cookie = `CookieLogged=${"Minou"}; expires=${new Date(Date.now() + 60 * 24 * 60 * 60 * 1000).toUTCString()}; path=/`;
      window.location.href = '/';
    }


 

    return (
      <Container className="flex flex-col items-center justify-center h-screen">
          <Title ta="center" className= 'title' mt={-10}>
            Inventaire CSHC 
          </Title>
          <Paper withBorder shadow="md" p={30} mt={30} radius="md" className="w-96">
            <TextInput label="Nom d'utilisateur" placeholder="mleclerc" required value={username} onChange={handleUsernameChange} />
            <PasswordInput label="Mot de passe" placeholder="votre mot de passe" required mt="md" value={password} onChange={handlePasswordChange} />
            <Button  fullWidth mt="xl" color="indigo" variant="outline" onClick={handleLogin}>
              Login
            </Button>
            <Button  fullWidth mt="xl" color="indigo" variant="outline" onClick={bypass}>
              Bypass
            </Button>
          </Paper>
        </Container>
      );

}

export default Login; // Donâ€™t forget to use export default!
